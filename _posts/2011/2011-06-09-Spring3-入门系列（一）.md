---
layout: post
title: Spring3 入门系列（一）
category: java
tags: [java]
---

# Spring3 入门系列 #
## MVC ##
### Section 1 ###

  据说Spring的MVC很不错。

  开发步骤比较简单，需要spring.jar和common-logging.jar 就可以搭建起一个很简单的web。

 

#### 第一步：编写web.xml文件 #####

``` xml
<?xml version="1.0" encoding="UTF-8"?>  
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee   
    http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">  
      
    <servlet>  
        <servlet-name>vincent</servlet-name>  
        <servlet-class>  
            org.springframework.web.servlet.DispatcherServlet  
        </servlet-class>  
        <load-on-startup>1</load-on-startup>  
    </servlet>  
  
    <servlet-mapping>  
        <servlet-name>vincent</servlet-name>  
        <url-pattern>*.do</url-pattern>  
    </servlet-mapping>  
  
    <welcome-file-list>  
        <welcome-file>index.jsp</welcome-file>  
    </welcome-file-list>  
</web-app>  
``` 

#### 第二步：编写一个vincent-servlet.xml文件 ####

``` xml
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">  
  
<beans>  
  
    <bean id="viewResolver"  
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">  
        <property name="prefix" value="/WEB-INF/jsp/" />  
        <property name="suffix" value=".jsp" />  
    </bean>  
  
    <bean id="simpleUrlHandlerMapping"  
        class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">  
        <property name="mappings">  
            <props>  
                <prop key="/hello.do">helloController</prop>  
            </props>  
        </property>  
    </bean>  
  
    <bean id="helloController" class="com.vincent.action.HelloController">  
    </bean>  
  
</beans>  
``` 

#### 第三步：创建 HelloController.java文件 ####

``` java
package com.vincent.action;  
  
import javax.servlet.http.HttpServletRequest;  
import javax.servlet.http.HttpServletResponse;  
  
import org.springframework.web.servlet.ModelAndView;  
import org.springframework.web.servlet.mvc.Controller;  
  
/** 
 * @author vincent 
 */  
public class HelloController implements Controller {  
  
    @Override  
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {  
        request.setAttribute("first_hello", "hello Spring");  
        return new ModelAndView("hello");  
    }  
  
}  
``` 

#### 第四步：在WEB-INF下面建立一个jsp文件夹，创建一个hello.jsp文件 ####

```jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'index.jsp' starting page</title>  
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!--  
    <link rel="stylesheet" type="text/css" href="styles.css">  
    -->  
  </head>  
    
  <body>  
    ${first_hello}  
  </body>  
</html>
```
  
假如jar包，运行吧
http://localhost:8888/工程名/hello.do

个人理解的流程，由于和Spring In Action书里面的有点不一样，所以我留个记录

### Section 2 ###

Spring的MVC里面有多种的控制器，先介绍一下最简单的Controller，有两个一个是借口Controller，一个是抽象类AbstractController，这两个用法很简单，和一般的Java Servlet差不多。
还有一种就是表单的Controller，也是有两个AbstractFormController和SimpleFormController。
它的模式基本上和Struts1差不多，只是配置不一样，实体不需要继承。

#### 首先搭建环境 ####

##### web.xml #####

``` xml
<?xml version="1.0" encoding="UTF-8"?>  
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee   
    http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">  
      
    <servlet>  
        <servlet-name>vincent</servlet-name>  
        <servlet-class>  
            org.springframework.web.servlet.DispatcherServlet  
        </servlet-class>  
        <load-on-startup>1</load-on-startup>  
    </servlet>  
  
    <servlet-mapping>  
        <servlet-name>vincent</servlet-name>  
        <url-pattern>*.do</url-pattern>  
    </servlet-mapping>  
  
    <welcome-file-list>  
        <welcome-file>index.jsp</welcome-file>  
    </welcome-file-list>  
</web-app>  
``` 

##### Controller类:RegisterStudentController.java #####

```java
package com.vincent.action;  
  
import org.springframework.web.servlet.mvc.SimpleFormController;  
  
import com.vincent.bean.Student;  
  
public class RegisterStudentController extends SimpleFormController{  
  
    public RegisterStudentController(){  
        setCommandClass(Student.class);  
    }  
      
    @Override  
    protected void doSubmitAction(Object command) throws Exception {  
        System.out.println(command.getClass());  
        Student s = (Student) command;  
        System.out.println(s.getStudentName());  
        System.out.println(s.getStudentPassword());  
    }  
      
      
}  
```
 
##### 实体类：Student.java #####

```java 
package com.vincent.bean;  
  
public class Student {  
    private String studentName;  
    private String studentPassword;  
    public String getStudentName() {  
        return studentName;  
    }  
    public void setStudentName(String studentName) {  
        this.studentName = studentName;  
    }  
    public String getStudentPassword() {  
        return studentPassword;  
    }  
    public void setStudentPassword(String studentPassword) {  
        this.studentPassword = studentPassword;  
    }  
      
}  
``` 

##### 表单的jsp文件:register_start.jsp #####

```jsp 
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'register_start.jsp' starting page</title>  
      
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">    <%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%> 
``` 

##### 表单的jsp文件:/WEB-INF/jsp/register_result.jsp #####  

``` jsp
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'register_result.jsp' starting page</title>  
      
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  
  </head>  
    
  <body>  
   info:${register_info}  
  </body>  
</html>  
 d2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  
  </head>  
    
  <body>  
    <form action="/spring-mvc001/register.do" method="post">  
        <input type="text" name="studentName"/><br/>  
        <input type="password" name="studentPassword" /><br/>  
        <input type="submit" value="Submit"/>  
    </form>  
  </body>  
</html>  
``` 

##### Spring的配置文件：vincent-servlet.xml #####

``` xml 
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">  
  
<beans>  
  
    <bean id="viewResolver"  
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">  
        <property name="prefix" value="/WEB-INF/jsp/" />  
        <property name="suffix" value=".jsp" />  
    </bean>  
  
    <bean id="simpleUrlHandlerMapping"  
        class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">  
        <property name="mappings">  
                <prop key="/register.do">registerStudentController</prop>  
            </props>  
        </property>  
    </bean>  
  
    <bean id="registerStudentController" class="com.vincent.action.RegisterStudentController">  
        <property name="successView">  
            <value>register_result</value>  
        </property>  
    </bean>  
  
</beans>  
 ```

##### 运行：http://localhost:8888/工程名/register_start.jsp #####

其实还有第二种写法的，上面的写法是没有办法传出数据！所以重写的方法不一样

``` java 
package com.vincent.action;  
  
import javax.servlet.http.HttpServletRequest;  
import javax.servlet.http.HttpServletResponse;  
  
import org.springframework.validation.BindException;  
import org.springframework.web.servlet.ModelAndView;  
import org.springframework.web.servlet.mvc.SimpleFormController;  
  
import com.vincent.bean.Student;  
  
public class RegisterStudentController extends SimpleFormController{  
  
    public RegisterStudentController(){  
        setCommandClass(Student.class);  
    }  
      
    @Override  
    protected ModelAndView onSubmit(HttpServletRequest request, HttpServletResponse response,   
            Object command, BindException errors) throws Exception {  
          
        System.out.println(command.getClass());  
          
        return new ModelAndView(getSuccessView(),"register_info","this is not info");  
        /** 
        *   或者这样写 
        *   return new ModelAndView("register_result","register_info","this is not info"); 
        */  
    }  
      
      
}  
```  
Java类不能两个方法都实现，否则只会执行OnSubmit()，这个是要注意的！
在重写了OnSubmitAction()之后必须配置

``` xml 
<property name="successView">  
    <value>register_result</value>  
</property>
```  

而OnSubmit()方法可以不配置！
表单必须使用post提交才能转到Controller里面

### Section 3 ###

Spring MVC分步提交的功能，我觉得很强大，可以使表单不用太长，用户操作比较舒服！而且让用户更容易找出填写不对的地方！
经过千辛万苦，终于做出来了！一个自己认为比较好的例子，当然网上比这例子好的一大把，但是还是自己给自己留个笔记吧！方便日后回顾！

#### web.xml ####

``` xml
<?xml version="1.0" encoding="UTF-8"?>  
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee   
    http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">  
      
    <servlet>  
        <servlet-name>vincent</servlet-name>  
        <servlet-class>  
            org.springframework.web.servlet.DispatcherServlet  
        </servlet-class>  
        <load-on-startup>1</load-on-startup>  
    </servlet>  
  
    <servlet-mapping>  
        <servlet-name>vincent</servlet-name>  
        <url-pattern>*.do</url-pattern>  
    </servlet-mapping>  
  
    <welcome-file-list>  
        <welcome-file>index.jsp</welcome-file>  
    </welcome-file-list>  
  
</web-app>
```

#### vincent-servlet.xml ####

``` xml
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">  
  
<beans>  
  
    <bean id="viewResolver"  
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">  
        <property name="prefix" value="/WEB-INF/jsp/" />  
        <property name="suffix" value=".jsp" />  
    </bean>  
  
    <bean id="simpleUrlHandlerMapping"  
        class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">  
        <property name="mappings">  
            <props>  
                <prop key="/register.do">feedbackController</prop>  
            </props>  
        </property>  
    </bean>  
  
    <bean id="feedbackController" class="com.vincent.action.FeedbackWizardController">  
        <property name="pages">  
            <list>  
                <value>general</value>  
                <value>instructor</value>  
                <value>course</value>  
                <value>facilities</value>  
            </list>  
        </property>  
    </bean>  
</beans> 
```

#### FeedbackWizardController.java ####

``` java
package com.vincent.action;  
  
import javax.servlet.http.HttpServletRequest;  
import javax.servlet.http.HttpServletResponse;  
  
import org.springframework.validation.BindException;  
import org.springframework.validation.Errors;  
import org.springframework.validation.ValidationUtils;  
import org.springframework.web.servlet.ModelAndView;  
import org.springframework.web.servlet.mvc.AbstractWizardFormController;  
  
import com.vincent.bean.FeedBackBean;  
  
public class FeedbackWizardController extends AbstractWizardFormController {  
  
    public FeedbackWizardController(){  
        setCommandClass(FeedBackBean.class);  
    }  
      
    @Override  
    protected ModelAndView processFinish(HttpServletRequest request, HttpServletResponse response,  
            Object command, BindException errors) throws Exception {  
        System.out.println("protected ModelAndView processFinish");  
        FeedBackBean fb = (FeedBackBean) command;  
        System.out.println(fb.getGeneral());  
        System.out.println(fb.getInstructor());  
        System.out.println(fb.getCourse());  
        System.out.println(fb.getFacilities());  
        return new ModelAndView("success");  
    }  
      
    @Override  
    protected void validatePage(Object command, Errors errors, int page) {  
        FeedBackBean fb = (FeedBackBean) command;  
        System.out.println(fb.getGeneral());  
        System.out.println(fb.getInstructor());  
        System.out.println(fb.getCourse());  
        System.out.println(fb.getFacilities());  
          
        if(fb.getGeneral().equals("vincent") && page == 0){  
            System.out.println("protected void validatePage");  
        }else if(page == 0){  
            /** 
             *  这个是检测是否为空，并且是否是空格键  
             *  ValidationUtils.rejectIfEmptyOrWhitespace(errors, "general", "required.general","general is required"); 
             * */  
              
            errors.rejectValue("general", "error.general","general is error");  
        }  
          
        if(page == 1 && fb.getInstructor().equals("plato")) {  
            System.out.println("protected void validatePage");  
        }else if(page == 1){  
          
             ValidationUtils.rejectIfEmptyOrWhitespace(errors, "instructor", "required.Instructor","Instructor is required");  
              
              
            /*errors.rejectValue("general", "error.general","general is error");*/  
        }  
    }  
      
      
    @Override  
    protected ModelAndView processCancel(HttpServletRequest request, HttpServletResponse response, Object command, BindException errors) throws Exception {  
        System.out.println("protected ModelAndView processCancel");  
        return new ModelAndView("home");  
    }  
      
} 
```

#### FeedBackBean.java ####

``` java
package com.vincent.bean;  
  
public class FeedBackBean {  
    private String general;  
    private String instructor;  
    private String course;  
    private String facilities;  
    public String getGeneral() {  
        return general;  
    }  
    public void setGeneral(String general) {  
        this.general = general;  
    }  
    public String getInstructor() {  
        return instructor;  
    }  
    public void setInstructor(String instructor) {  
        this.instructor = instructor;  
    }  
    public String getCourse() {  
        return course;  
    }  
    public void setCourse(String course) {  
        this.course = course;  
    }  
    public String getFacilities() {  
        return facilities;  
    }  
    public void setFacilities(String facilities) {  
        this.facilities = facilities;  
    }  
      
} 
```
最后就是在/WEB-INF/jsp 目录下面的jsp文件了。

#### general.jsp ####
``` jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <title>My JSP 'index.jsp' starting page</title>  
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  </head>  
    
  <body>  
    This is general.jsp  
    <form:form action="/spring-mvc002/register.do" method="post">  
        <form:input path="general"/>  
        <input type="submit" value="Next" name="_target1"/>         
        <form:errors path="general" cssStyle="color:red"/>  
    </form:form>  
  </body>  
</html>  
``` 

#### instructor.jsp ####
``` jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'index.jsp' starting page</title>  
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  </head>  
    
  <body>  
  This is instructor.jsp  
   <form:form action="/spring-mvc002/register.do" method="post">  
        <form:input  path="instructor"/>  
        <input type="submit" value="Back" name="_target0"/>         
        <input type="submit" value="Next" name="_target2"/>   
        <form:errors path="instructor" cssStyle="color:red"/>       
    </form:form>  
  </body>  
</html>  
``` 

#### course.jsp ####
``` jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'index.jsp' starting page</title>  
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  </head>  
    
  <body>  
  This is course.jsp  
   <form:form action="/spring-mvc002/register.do" method="post">  
        <form:input path="course"/>  
        <input type="submit" value="Back" name="_target1"/>         
        <input type="submit" value="Next" name="_target3"/>         
    </form:form>  
  </body>  
</html>  
``` 

#### facilities.jsp ####
```jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>  
<%  
String path = request.getContextPath();  
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";  
%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <base href="<%=basePath%>">  
      
    <title>My JSP 'index.jsp' starting page</title>  
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  </head>  
    
  <body>  
        This is facilities.jsp  
    <form:form action="/spring-mvc002/register.do" method="post">  
        <form:input path="facilities"/>  
        <input type="submit" value="Cancel" name="_cancel"/>        
        <input type="submit" value="Back" name="_target2"/>         
        <input type="submit" value="Finish" name="_finish"/>        
    </form:form>  
  </body>  
</html>  
``` 

#### home.jsp ####
``` jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <title>My JSP 'home.jsp' starting page</title>  
      
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  
  </head>  
    
  <body>  
    This is home page. <br>  
  </body>  
</html>  
``` 

#### success.jsp ####
``` jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>  
  
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">  
<html>  
  <head>  
    <title>My JSP 'success.jsp' starting page</title>  
      
    <meta http-equiv="pragma" content="no-cache">  
    <meta http-equiv="cache-control" content="no-cache">  
    <meta http-equiv="expires" content="0">      
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">  
    <meta http-equiv="description" content="This is my page">  
    <!-- 
    <link rel="stylesheet" type="text/css" href="styles.css"> 
    -->  
  
  </head>  
    
  <body>  
    This is success page. <br>  
  </body>  
</html>  
``` 

访问地址:http://localhost:8888/工程名/register.do

其实我个人不爱使用框架的标签，但是错误信息需要它的标签才可以显示，还有使用它的标签还有一个好处就是在退后的时候文本框可以保留原值！

 
